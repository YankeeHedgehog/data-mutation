# 設計資料

## 目的

データ更新を管理略化するためのツール群を有したシステムを構築する

## 対象

こいつの責任 -> データ更新用の資料を作成する or データ更新に利用する SQL を構築する

### 対象の団体

現状登録されているすべての自治体

### 対象の範囲のシステム

確定

- ciel

未確定

- Aegis
- Citron
- FM
- CrossTown
- Town

## 実装内容

### 対象のシステムと誰が更新するのか履歴を残せるようにする

- アカウントごとに認証を用意し、各更新の対象者はログイン後に作業をこなう
-

### 確定を押すまで更新は社内本番同等環境には適用しない

### Ciel の各種レイヤの設定を行えるようにする

- まずは一つずつ行えるようにする
- その次に複数のレイヤに対して変更を行えるようにする？ -> 必要ない \* 各レイヤに対して、チェックボックをテーブル上に配置して設定できるようにすればいい
- 各テーブルの列項目に変更に関する影響のドキュメントをヘルプとして添付できるようにする

### 設計思想

**オニオンアーキテククチャ**

- 各レイヤーごとにデータの移動を作成する
  - バグが発生するのはデータの設定になるので、しっかりとしたレイヤー分けを行う
- 各更新に関して、システムの中でのみ設定を行うように促す => データ更新の品質のばらつき改善を行う

### フェーズ

1. フェーズ 1 第一段階としてデータ更新エクセルと品質、データ更新用のデータを出力できるようにする => あくまでデータ更新のツールであること

- ログイン画面、サインアウト画面の作成
- メインページ
  - データ更新の対象団体と日付を選択する => redmine のチケットと統合して、チケットを作成すると自動で生成するようにしてもいいかもしれない
    - アカウントは AutoComplite 形式にして、アカウント一覧表の excel を読み出すように設定する => アカウント表の列項目が変更された際にこちらも変更する必要がある
      - 詳細設定で列項目も選択できるようにする
  - 過去のデータ更新の履歴を見れるようにする
  - システムの選択ができる
- データ更新詳細ページ
  - システムごとに詳細ページの仕様は異なる
    - Ciel
      - 基本設定の変更
        - swd の変更: changeSwdFile(from, to) => responseStatus
      - レイヤの変更
        - レイヤ名の変更: changeLayerName(from, to) => responseStatus
        - レイヤの設定の変更
          - 初期表示レイヤの設定: setCurrentLayer(account, targetLayer) => status
          - 作図可能か: setDrawableLayer(account, targetLayer, isDrawable) => status
        - idb の参照先変更: changeIdbReference(swd, layerName, to) => status
      - 検索設定の変更
        - 検索名称の変更: changeSearchConditionName(searchCondition, to) => status
        - 検索対象の変更: changeSearchTarget(searchCondition, to) => status
        - 検索条件の選択: selectSearchConditionSetting(searchCondition, to) => status
        - 選択設定とデフォルトを変更
      - 各種機能の設定
        - 有効にする機能の選択
        - それぞれの機能に関する設定
          - 作図機能
            - 画像取り込み機能の有効/無効(レイヤを選択する)
            - 一括作図の有効/無効
          - 計測機能
          - 印刷機能
            - 印刷テンプレートの変更
            - スケールのデフォルトの設定
            - 方位シンボル・スケールバー・中心座標
            - 出力機能のデフォルトの設定
          - 家屋台帳
          - 水道機能
        - その他機能
          - 属性による色分け機能
          - シェープファイルの取り込み機能
    - 複数のアカウントに対して設定を行うときはどうする？
      - 候補 1. 複数の選択を行える
      - 候補 2. 設定の複製を行える
  - プレビュー機能
    - アカウント一覧の excel から情報を取得して、アプリケーションを確認できるようにする
- DB の内容
  - User の情報
  - 対象アカウントの DB などの接続先情報
  - アカウントの情報
  - 変更内容の情報
    - 変更対象 DB? ファイル?
    - 変更内容

1. フェーズ 2 第二段階としてデータ更新のコマンドをすべて作成するようにする

- 上記のフェーズ 2. の範囲にデータ更新の社内適用までを含める
- この段階で、システムの信頼性を高めるためにクエリの検証を行えると良い

3. フェーズ 3 第三段階としてデータ更新のコマンドを客先の環境で全て流し、自動でテストを行う

- テストは e2e で行う
- テストを自動生成するツールを作成する
